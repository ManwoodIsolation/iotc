'use strict';

var constants = require('../constants-D-YMDg7M.js');

const creator = () => {
    return {
        postcssPlugin: 'postcss-weapp-tw-css-macro-plugin',
        prepare() {
            return {
                AtRule(atRule, helper) {
                    if (atRule.name === 'media') {
                        const values = [];
                        constants.matchCustomPropertyFromValue(atRule.params, (arr) => {
                            values.push(arr[1]);
                        });
                        if (values.length > 0) {
                            const isNegative = atRule.params.includes('not');
                            const text = values.join(' ');
                            const comment = isNegative ? constants.ifndef(text) : constants.ifdef(text);
                            atRule.before([
                                helper.comment({
                                    raws: {
                                        before: '\n'
                                    },
                                    text: comment.start
                                }),
                                ...atRule.nodes,
                                helper.comment({
                                    raws: {
                                        before: '\n'
                                    },
                                    text: comment.end
                                })
                            ]);
                            atRule.remove();
                        }
                    }
                },
                CommentExit(comment) {
                    if (/#(?:ifn?def|endif)/.test(comment.text)) {
                        comment.raws.left = ' ';
                        comment.raws.right = ' ';
                    }
                }
            };
        }
    };
};
creator.postcss = true;

module.exports = creator;
